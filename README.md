
프로젝트 실행

```bash
make compose-up
```

프로젝트 종료 (과제 앱의 이미지만 삭제하고 mysql 5.7은 삭제 하지 않습니다)

```bash
make compose-clean
```

## 단위 테스트

```bash
make test
```

### API 테스트 (API SPEC스팩은 스웨거)

```bash
http://localhost:3000/swagger/index.html#/
```

원할한 과제 테스트를 위해 swageer의 example을 추가하여 스웨거상에서 테스트 할 수 있도록 했습니다.
필수구현 요구사항을 보고 아래의 시나리오로 테스트를 진행 할 수 있습니다.

1. 관리자, 학생 두 유형의 타입으로 회원가입을 한다.
2. 관리자는 학교를 생성한다.
3. 관리자는 생성한 학교를 조회해 학교의 ID을 확인하고 해당 학교로 소식을 발행한다.
4. 학생은 학교 목록을 조회해 학교의 ID을 확인하고 해당 학교를 구독 할 수 있다.
5. 학생은 구독중인 학교의 목록을 확인 할 수 있다.
6. 학생은 구독중안 학교의 ID을 활용해 각각의 학교의 소식을 볼 수 있다. (id을 통해 최신 정렬 확인 가능)

### 초기 샘플 데이터

```bash
mysql 디비 접속정보
user: classting
dbName: classting
password: classting
```

한명의 학생 유저가 서로 다른 학교를 구독하고 있을 때 각각의 학교별로 소식을 조회 할 수 있는 환경의 샘플 데이터를 준비했습니다.
기본적으로 커서 기반으로 데이터를 10개씩 페이징 할 수 있도록 해서 데이터의 개수를 한 두개가 아니라 10개이상 추가해두었습니다.
관리자의 경우 기본적으로 학교 페이지를 갖고 있지만 하나 이상의 학교 페이지를 생성 할 수 있습니다. 


#### 사용자

| user_name           | password                                       | user_type |
|---------------------|------------------------------------------------|-----------|
| classting_admin_1  | $2a$10$Q2w/PDGj.iS1vKCMRnIJ1uuTG7jzQn13Mu4IplYgwmyTtod7yCHAu | ADMIN |
| classting_admin_2  | $2a$10$Q2w/PDGj.iS1vKCMRnIJ1uuTG7jzQn13Mu4IplYgwmyTtod7yCHAu | ADMIN |
| classting_admin_3  | $2a$10$Q2w/PDGj.iS1vKCMRnIJ1uuTG7jzQn13Mu4IplYgwmyTtod7yCHAu | ADMIN |
| classting_student_1 | $2a$10$kxG7/4JAyyRkGcn7ZkgZFu2RpUpRtf/CnA.L4p/L7JaAbth/iQKUG | STUDENT |
| empty_classting_admin | $2a$10$Q2w/PDGj.iS1vKCMRnIJ1uuTG7jzQn13Mu4IplYgwmyTtod7yCHAu | ADMIN |
| empty_classting_student | $2a$10$Q2w/PDGj.iS1vKCMRnIJ1uuTG7jzQn13Mu4IplYgwmyTtod7yCHAu | STUDENT |

#### 학교 페이지

| name                               | region | user_id |
|------------------------------------|--------|---------|
| admin_1_뉴스가_있는_클래스팅 서울학교 | 서울   | 1       |
| admin_1_뉴스가_있는_클래스팅 대전학교 | 대전   | 1       |
| admin_2_뉴스가_있는_클래스팅 다른 인천학교 | 인천 | 2       |
| admin_3_페이지네이션_확인_학교_1      | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_2      | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_3      | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_4      | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_5      | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_6      | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_7      | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_8      | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_9      | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_10     | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_11     | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_12     | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_13     | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_14     | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_15     | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_16     | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_17     | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_18     | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_19     | 울산   | 3       |
| admin_3_페이지네이션_확인_학교_20     | 울산   | 3       |

#### 구독
| user_id | school_id |
|---------|-----------|
| 4       | 1         |
| 4       | 2         |
| 4       | 3         |
| 4       | 4         |
| 4       | 5         |
| 4       | 6         |
| 4       | 7         |
| 4       | 8         |
| 4       | 9         |
| 4       | 10        |
| 4       | 11        |
| 4       | 12        |
| 4       | 13        |
| 4       | 14        |
| 4       | 15        |
| 4       | 16        |
| 4       | 17        |
| 4       | 18        |
| 4       | 19        |
| 4       | 20        |
| 4       | 21        |
| 4       | 22        |
| 4       | 23        |
#### 뉴스
| title                                     | user_id | school_id |
|-------------------------------------------|---------|-----------|
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_1 | 1       | 1         |
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_2 | 1       | 1         |
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_3 | 1       | 1         |
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_4 | 1       | 1         |
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_5 | 1       | 1         |
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_6 | 1       | 1         |
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_7 | 1       | 1         |
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_8 | 1       | 1         |
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_9 | 1       | 1         |
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_10 | 1      | 1         |
| admin_1_뉴스가_있는_클래스팅 서울학교_뉴스_11 | 1      | 1         |
| admin_1_뉴스가_있는_클래스팅 대전학교_뉴스_1 | 1       | 2         |
| admin_1_뉴스가_있는_클래스팅 대전학교_뉴스_2 | 1       | 2         |
| admin_1_뉴스가_있는_클래스팅 대전학교_뉴스_3 | 1       | 2         |
| admin_1_뉴스가_있는_클래스팅 대전학교_뉴스_4 | 1       | 2         |
| admin_1_뉴스가_있는_클래스팅 대전학교_뉴스_5 | 1       | 2         |
| admin_2_뉴스가_있는_클래스팅 인천학교_뉴스_1 | 2       | 3         |


### 프로젝트 실행

여러 개의 도커 이미지를 연결하여 띄우려면 Docker Compose를 사용하는 것이 일반적인 방법이라고 생각했습니다. 요구사항에 도커 컴포즈를 사용하라고 명시되어 있진 않았지만 두 개의 서비스를 실행하고 서로 통신하기에 용이하다고 생각했습니다.

# 과제를 수행하면서

과제 요구사항을 보고 어떻게 접근했는지 개인적인 견해를 정리하였습니다.

## 기술 선택 이유
일단 과제 수행에 개발 스택에 제한이 없어서 현재 필수 구현 요구사항에 만족 하도록 현재 익숙한 개발 스택을 사용하였습니다.
golang을 이용해서 개발하였는데 router, swagger을 제외하고 언어에서 제공하는 기본 패키지를 사용해 과제 진행하였습니다.

## 도메인 설계에 대한 생각
필수 구현에서는 유저, 학교, 소식, 구독 네가지의 도메인이 있으면 된다고 생각했습니다.

유저는 유저 유형을 포함하는게 현재 요구사항의 문제를 푸는 키라고 생각했습니다.
학교와 학생은 N:M 관계이므로 중간 테이블인 구독을 두어 관리하는게 구현 편의상 좋을 것이라고 생각해 구독이란 테이블을 추가했습니다.

추가 구현을 고려한다면 뉴스피드라는 테이블을 별도로 두고 각 구독중인 학교에서 소식을 발행 할 때 각 유저의 뉴스피드에 추가하면 문제를 해결 할 수 있다고 생각했지만 개인적인 시간이 부족하여 추가 구현까지는 수행하지 못했습니다.

## 업무 분할 및 각 API에 설계 생각 

과제를 수행하면서 현업에서 업무하듯 요구사항에 따라 각각의 도메인을 나누고 해당 도메인의 레이어를 구분하여 작업하였습니다.
초기에는 이슈템플릿에 간단하게 어떻게 생각해서 진행할 생각인지 적었습니다. 하지만 과제 검토시 이슈별로 보기 어려울 것 같아 이슈를 구분만 해두고 아래에서 각 API에 대해 어떻게 생각하고 접근 했는지 적으려고 합니다.

제가 과제를 수행하면서 개인적으로 든 생각은 요구사항에 따른 행위를 정의하고 그 행위를 API을 통해 잘 수행 할 수 있는지 보는 것 같았습니다. 왜냐하면 별도의 필수 요구 필드나 벨리데이션 부분이 없었기 때문에 벨리데이션의 경우 빈 값의 경우만 에러로 처리하였습니다.


#### 소식 
- 소식 발행 : 소식을 구분 할 수 있는 제목이란 필드가 있고 제목이 빈 문자열 경우 잘못된 요청으로 처리
- 소식 수정 : 자신이 소유한 학교의 소식인지 구분하고 자신의 소유한 학교가 아니라면 에러 처리
- 소식 조회 : 자신의 소유한 학교 중 선택한 학교의 소식만 목록을 커서 기반으로 10개씩 아이디 기반으로 최신 순 정렬
- 소식 삭제 : 발행한 소식을 소프트 딜리트

#### 학교
- 학교 조회 : 관리자, 학생 관계없이 학교의 목록을 볼 수 있음
- 학교 생성 : 관리자 권한을 갖은 유저만 학교를 생성 할 수 있고 하나 이상의 학교를 갖을 수 있음

#### 구독
- 구독 생성 : 구독 중이지 않은 학교를 구독 할 수 있고 구독 중이면 에러
- 구독 조회 : 구독 중인 학교의 목록을 커서 기반으로 10개씩 아이디 기반으로 최신 순 정렬
- 구독 삭제 : 구독 중인 학교를 삭제 하드 딜리트
- 구독 중인 학교의 소식 조회 : 구독 중인 학교에서 발행한 모든 소식을 커서 기반으로 10개씩 조회 아이디 기반으로 최신 순 정렬 

#### 유저
- 유저 생성 : 유저 유형을 구분하고 비밀번호를 암호화해서 회원가입
- 유저 로그인 : 만료기한이 24시간인 토큰을 발행하여 로그인 처리

# 필수 구현 스키마

#### users
- 유저는 사용자를 구분하기 위해 유저유형의 속성을 갖는다.
#### schools
- 스쿨은 학교 페이지 생성시 생성되며 지역, 이름 두개를 유니크로 설정한다.
#### subscriptions
- 학생은 하나 이상의 학교를 구독 할 수 있고 학교도 한명 이상의 학생을 갖을 수 있는 N:M구조이므로 중간 테이블을 생성한다.
#### news
- 학교의 소식을 담당한다.

![](https://velog.velcdn.com/images/jakdangers/post/7bb00924-479e-4432-b870-ee6ce9fda865/image.png)

# 필수 구현 API
필수 구현 사항의 확인을 쉽게 하기 위해 각 요구사항에 대해 스웨거 링크를 달아두었습니다.

학교 관리자는 학교를 페이지를 운영하여 학교 소식을 발행할 수 있다
- [학교 관리자는 지역, 학교명으로 학교 페이지를 생성할 수 있다.](http://localhost:3000/swagger/index.html#/Schools/post_schools)
- [학교 관리자는 학교 페이지 내에 소식을 작성할 수 있다.](http://localhost:3000/swagger/index.html#/News/post_news)
- [학교 관리자는 작성된 소식을 수정할 수 있다.](http://localhost:3000/swagger/index.html#/News/put_news)
- [학교 관리자는 작성된 소식을 삭제할 수 있다.](http://localhost:3000/swagger/index.html#/News/delete_news__newsID_)

학생은 학교 페이지를 구독하여 학교 소식을 받아 볼 수 있다
- [학생은 학교 페이지를 구독할 수 있다.](http://localhost:3000/swagger/index.html#/Subscription/post_subscriptions)
- [학생은 구독 중인 학교 페이지 목록을 확인할 수 있다.](http://localhost:3000/swagger/index.html#/Subscription/get_subscriptions)
- [학생은 구독 중인 학교 페이지를 구독 취소할 수 있다.](http://localhost:3000/swagger/index.html#/Subscription/delete_subscriptions__schoolID_)
- [학생은 구독 중인 학교 페이지별 소식을 볼 수 있다. (학교별 소식은 최신순으로 노출해야 함)](http://localhost:3000/swagger/index.html#/Subscription/get_subscriptions_news__schoolID_)


### 테스트 도우미 API
필수 구현 사항의 API의 동작을 수행하기 위해 추가적으로 필요하다고 생각한 API을 추가하였습니다.
유저 인증의 경우 필수 구현에 해당하진 않지만 실제 개발 환경이라면 필요한 부분이라고 생각되어 단순하게 아이디 비밀번호를 통해 회원가입하고 토큰 방식으로 로그인 할 수 있도록 추가해두었습니다.
관리자의 소식 목록 조회는 필수 구현은 아니나 수정, 삭제를 하려고 하면 관리자가 발행한 소식을 확인 할 수 있어야 되서 추가했습니다.	

- [회원 유형을 구분하기 위한 회원가입](http://localhost:3000/swagger/index.html#/User/post_users)
- [회원 로그인](http://localhost:3000/swagger/index.html#/User/post_users_login)
- [관리자의 소식 수정, 삭제를 위한 소식 목록](http://localhost:3000/swagger/index.html#/News/get_news)
